!function(){"use strict";function n(){function n(n,e){return['<div class="ng-webcam no-overlay" ng-class="{\'no-overlay\' : vm.counter === 0 || vm.config.countdown === 0}">','<span ng-show="vm.webcamLive === true && vm.config.countdown > 0 && vm.counter > 0" id="ng-webcam-counter">{{vm.counter}}</span>','<img ng-show="vm.webcamLive === true" id="ng-webcam-overlay" src="{{vm.config.overlay}}" />','<div id="ng-webcam-container"></div>',"</div>"].join("")}function e(n,e,o,i){i.init(),n.$on("$destroy",function(){i.destroy()})}function o(n,e){function o(){l.config=l.config||{},window.localStorage&&window.localStorage.setItem("visited","1"),angular.isUndefined(l.config.viewerWidth)&&(l.config.viewerWidth="auto"),angular.isUndefined(l.config.viewerHeight)&&(l.config.viewerHeight="auto"),angular.isUndefined(l.config.outputWidth)&&(l.config.outputWidth=320),angular.isUndefined(l.config.outputHeight)&&(l.config.outputHeight=240),angular.isUndefined(l.config.delay)&&(l.config.delay=0),angular.isUndefined(l.config.shots)&&(l.config.shots=1),angular.isUndefined(l.config.countdown)&&(l.config.countdown=0),c(),t()}function i(){l.webcamLive&&Webcam.reset(),l.webcamLive=!1,l.webcamLoaded=!1,angular.isDefined(s)&&(e.cancel(s),s=void 0),angular.isDefined(d)&&(e.cancel(d),d=void 0),l.counter=3}function t(){angular.isDefined(l.config.shutterUrl)&&(u=new Audio,u.autoplay=!1,navigator.userAgent.match(/Firefox/)?u.src=l.config.shutterUrl.split(".")[0]+".ogg":u.src=l.config.shutterUrl),Webcam.set({width:l.config.viewerWidth,height:l.config.viewerHeight,dest_width:l.config.outputWidth,dest_height:l.config.outputHeight,force_flash:!1,image_format:"jpeg",jpeg_quality:100,flip_horiz:!0}),angular.isDefined(l.config.flashNotDetectedText)&&Webcam.set("flashNotDetectedText",l.config.flashNotDetectedText),angular.isDefined(l.config.flashFallbackUrl)&&Webcam.setSWFLocation(l.config.flashFallbackUrl),Webcam.attach("#ng-webcam-container")}function c(){Webcam.on("load",function(){n.$apply(function(){l.webcamLoaded=!0,angular.isDefined(l.onLoad)&&l.onLoad()})}),Webcam.on("live",function(){n.$apply(function(){l.webcamLive=!0,angular.isDefined(l.onLive)&&l.onLive()})}),Webcam.on("error",function(n){angular.isDefined(l.onError)&&l.onError({err:n})})}function a(n){u&&u.play(),n===l.config.shots-1&&e.cancel(s),Webcam.snap(function(e){if(m[n]=e,n<l.config.shots-1&&angular.isDefined(l.onCaptureProgress)){var o=Math.round(100*(n+1)/l.config.shots);l.onCaptureProgress({src:e,progress:o})}if(n===l.config.shots-1&&angular.isDefined(l.onCaptureComplete))return l.onCaptureComplete({src:m})})}function r(){if(angular.isUndefined(l.config.countdown)){var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}else{if(void 0!==d)return;l.counter=3,d=e(function(){if(l.counter=l.counter-1,0===l.counter){d&&e.cancel(d);var n=0;s=e(function(){a(n),n++},1e3*l.config.delay,l.config.shots)}},1e3,3)}}function f(){Webcam.attach("#ng-webcam-container")}function g(){i()}var u,s,d,l=this,m=[];l.webcamLoaded=!1,l.webcamLive=!1,l.counter=3,l.init=o,l.destroy=i,n.$on("ngWebcam_capture",r),n.$on("ngWebcam_on",f),n.$on("ngWebcam_off",g)}var i={restrict:"E",template:n,link:e,bindToController:!0,controller:o,controllerAs:"vm",scope:{config:"=",onCaptureComplete:"&",onError:"&",onLoad:"&",onCaptureProgress:"&",onLive:"&"}};return o.$inject=["$scope","$interval"],i}angular.module("ng-webcam",[]).directive("ngWebcam",n),n.$inject=[]}();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5nLXdlYmNhbS5qcyJdLCJuYW1lcyI6WyJuZ1dlYmNhbSIsInRlbXBsYXRlIiwiZWxlbWVudCIsImF0dHJzIiwiam9pbiIsImxpbmsiLCJzY29wZSIsImN0cmwiLCJpbml0IiwiJG9uIiwiZGVzdHJveSIsIm5nV2ViY2FtQ29udHJvbGxlciIsIiRzY29wZSIsIiRpbnRlcnZhbCIsInZtIiwiY29uZmlnIiwid2luZG93IiwibG9jYWxTdG9yYWdlIiwic2V0SXRlbSIsImFuZ3VsYXIiLCJpc1VuZGVmaW5lZCIsInZpZXdlcldpZHRoIiwidmlld2VySGVpZ2h0Iiwib3V0cHV0V2lkdGgiLCJvdXRwdXRIZWlnaHQiLCJkZWxheSIsInNob3RzIiwiY291bnRkb3duIiwiY29uZmlndXJlTGlzdGVuZXJzIiwiY29uZmlndXJlIiwid2ViY2FtTGl2ZSIsIldlYmNhbSIsInJlc2V0Iiwid2ViY2FtTG9hZGVkIiwiaXNEZWZpbmVkIiwic25hcHNob3RUaW1lciIsImNhbmNlbCIsInVuZGVmaW5lZCIsImNvdW50ZG93blRpbWVyIiwiY291bnRlciIsInNodXR0ZXJVcmwiLCJzb3VuZCIsIkF1ZGlvIiwiYXV0b3BsYXkiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJtYXRjaCIsInNyYyIsInNwbGl0Iiwic2V0Iiwid2lkdGgiLCJoZWlnaHQiLCJkZXN0X3dpZHRoIiwiZGVzdF9oZWlnaHQiLCJmb3JjZV9mbGFzaCIsImltYWdlX2Zvcm1hdCIsImpwZWdfcXVhbGl0eSIsImZsaXBfaG9yaXoiLCJmbGFzaE5vdERldGVjdGVkVGV4dCIsImZsYXNoRmFsbGJhY2tVcmwiLCJzZXRTV0ZMb2NhdGlvbiIsImF0dGFjaCIsIm9uIiwiJGFwcGx5Iiwib25Mb2FkIiwib25MaXZlIiwiZXJyIiwib25FcnJvciIsImNhcHR1cmUiLCJpbmRleCIsInBsYXkiLCJzbmFwIiwiZGF0YV91cmkiLCJpbWFnZXMiLCJvbkNhcHR1cmVQcm9ncmVzcyIsInByb2dyZXNzIiwiTWF0aCIsInJvdW5kIiwib25DYXB0dXJlQ29tcGxldGUiLCJvbldlYmNhbUNhcHR1cmUiLCJjb3VudCIsIm9uV2ViY2FtT24iLCJvbldlYmNhbU9mZiIsInRoaXMiLCJkaXJlY3RpdmUiLCJyZXN0cmljdCIsImJpbmRUb0NvbnRyb2xsZXIiLCJjb250cm9sbGVyIiwiY29udHJvbGxlckFzIiwiJGluamVjdCIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkNBQUEsV0FDQSxZQXNCQSxTQUFBQSxLQWtCQSxRQUFBQyxHQUFBQyxFQUFBQyxHQUNBLE9BQUEsaUhBQ0EsbUlBQ0EsOEZBQ0EsdUNBQ0EsVUFBQUMsS0FBQSxJQUdBLFFBQUFDLEdBQUFDLEVBQUFKLEVBQUFDLEVBQUFJLEdBQ0FBLEVBQUFDLE9BQ0FGLEVBQUFHLElBQUEsV0FBQSxXQUNBRixFQUFBRyxZQU1BLFFBQUFDLEdBQUFDLEVBQUFDLEdBNENBLFFBQUFMLEtBQ0FNLEVBQUFDLE9BQUFELEVBQUFDLFdBQ0FDLE9BQUFDLGNBQUFELE9BQUFDLGFBQUFDLFFBQUEsVUFBQSxLQUNBQyxRQUFBQyxZQUFBTixFQUFBQyxPQUFBTSxlQUFBUCxFQUFBQyxPQUFBTSxZQUFBLFFBQ0FGLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFPLGdCQUFBUixFQUFBQyxPQUFBTyxhQUFBLFFBQ0FILFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFRLGVBQUFULEVBQUFDLE9BQUFRLFlBQUEsS0FDQUosUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVMsZ0JBQUFWLEVBQUFDLE9BQUFTLGFBQUEsS0FDQUwsUUFBQUMsWUFBQU4sRUFBQUMsT0FBQVUsU0FBQVgsRUFBQUMsT0FBQVUsTUFBQSxHQUNBTixRQUFBQyxZQUFBTixFQUFBQyxPQUFBVyxTQUFBWixFQUFBQyxPQUFBVyxNQUFBLEdBQ0FQLFFBQUFDLFlBQUFOLEVBQUFDLE9BQUFZLGFBQUFiLEVBQUFDLE9BQUFZLFVBQUEsR0FDQUMsSUFDQUMsSUFHQSxRQUFBbkIsS0FDQUksRUFBQWdCLFlBQUFDLE9BQUFDLFFBQ0FsQixFQUFBZ0IsWUFBQSxFQUNB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K0IsR0FBQU4sRUFBQUcsRUFEQXhCLEVBQUFxRSxLQUVBVixJQUNBM0QsR0FBQW1CLGNBQUEsRUFDQW5CLEVBQUFnQixZQUFBLEVBQ0FoQixFQUFBeUIsUUFBQSxFQUNBekIsRUFBQU4sS0FBQUEsRUFDQU0sRUFBQUosUUFBQUEsRUFXQUUsRUFBQUgsSUFBQSxtQkFBQXNFLEdBV0FuRSxFQUFBSCxJQUFBLGNBQUF3RSxHQVdBckUsRUFBQUgsSUFBQSxlQUFBeUUsR0E1RUEsR0FBQUUsSUFDQUMsU0FBQSxJQUNBcEYsU0FBQUEsRUFDQUksS0FBQUEsRUFDQWlGLGtCQUFBLEVBQ0FDLFdBQUE1RSxFQUNBNkUsYUFBQSxLQUNBbEYsT0FDQVMsT0FBQSxJQUNBK0Qsa0JBQUEsSUFDQVgsUUFBQSxJQUNBSCxPQUFBLElBQ0FVLGtCQUFBLElBQ0FULE9BQUEsS0F5TUEsT0F0TEF0RCxHQUFBOEUsU0FBQSxTQUFBLGFBc0xBTCxFQTVPQWpFLFFBQUF1RSxPQUFBLGdCQUFBTixVQUFBLFdBQUFwRixHQUNBQSxFQUFBeUYiLCJmaWxlIjoibmctd2ViY2FtLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpIHtcbiAgJ3VzZSBzdHJpY3QnO1xuICBhbmd1bGFyLm1vZHVsZSgnbmctd2ViY2FtJywgW10pLmRpcmVjdGl2ZSgnbmdXZWJjYW0nLCBuZ1dlYmNhbSk7XG4gIG5nV2ViY2FtLiRpbmplY3QgPSBbXTtcbiAgLyoqXG4gICAqICBAbmdkb2MgRGlyZWN0aXZlXG4gICAqICBAbmFtZSBuZy13ZWJjYW1cbiAgICogIEBkZXNjcmlwdGlvblxuICAgKlxuICAgKiAgRGlyZWN0aXZlIGZvciBjYXB0dXJpbmcgaW1hZ2VzIGZyb20geW91ciBjb21wdXRlcidzIGNhbWVyYSwgYW5kIGRlbGl2ZXJ5IHRoZW4gdG8geW91IGFzIGRhdGEgdXJpXG4gICAqXG4gICAqICBAdXNhZ2VcbiAgICogIGBgYGh0bWxcbiAgICogIDxuZy13ZWJjYW1cbiAgICogICAgY29uZmlnPVwidm0uY29uZmlnXCJcbiAgICogICAgb24tZXJyb3I9XCJ2bS5vbkVycm9yKGVycilcIlxuICAgKiAgICBvbi1sb2FkPVwidm0ub25Mb2FkKClcIlxuICAgKiAgICBvbi1saXZlPVwidm0ub25MaXZlKClcIlxuICAgKiAgICBvbi1jYXB0dXJlLXByb2dyZXNzPVwidm0ub25DYXB0dXJlUHJvZ3Jlc3Moc3JjLCBwcm9ncmVzcylcIlxuICAgKiAgICBvbi1jYXB0dXJlLWNvbXBsZXRlPVwidm0ub25DYXB0dXJlQ29tcGxldGUoc3JjKVwiPlxuICAgKiAgPC9uZy13ZWJjYW0+XG4gICAqICBgYGBcbiAgICovXG4gIGZ1bmN0aW9uIG5nV2ViY2FtKCkge1xuICAgIHZhciBkaXJlY3RpdmUgPSB7XG4gICAgICByZXN0cmljdDogJ0UnLFxuICAgICAgdGVtcGxhdGU6IHRlbXBsYXRlLFxuICAgICAgbGluazogbGluayxcbiAgICAgIGJpbmRUb0NvbnRyb2xsZXI6IHRydWUsXG4gICAgICBjb250cm9sbGVyOiBuZ1dlYmNhbUNvbnRyb2xsZXIsXG4gICAgICBjb250cm9sbGVyQXM6ICd2bScsXG4gICAgICBzY29wZToge1xuICAgICAgICBjb25maWc6ICc9JyxcbiAgICAgICAgb25DYXB0dXJlQ29tcGxldGU6ICcmJyxcbiAgICAgICAgb25FcnJvcjogJyYnLFxuICAgICAgICBvbkxvYWQ6ICcmJyxcbiAgICAgICAgb25DYXB0dXJlUHJvZ3Jlc3M6ICcmJyxcbiAgICAgICAgb25MaXZlOiAnJidcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgZnVuY3Rpb24gdGVtcGxhdGUoZWxlbWVudCwgYXR0cnMpIHtcbiAgICAgIHJldHVybiBbJzxkaXYgY2xhc3M9XCJuZy13ZWJjYW0gbm8tb3ZlcmxheVwiIG5nLWNsYXNzPVwie1xcJ25vLW92ZXJsYXlcXCcgOiB2bS5jb3VudGVyID09PSAwIHx8IHZtLmNvbmZpZy5jb3VudGRvd24gPT09IDB9XCI+JyxcbiAgICAgICAgJzxzcGFuIG5nLXNob3c9XCJ2bS53ZWJjYW1MaXZlID09PSB0cnVlICYmIHZtLmNvbmZpZy5jb3VudGRvd24gPiAwICYmIHZtLmNvdW50ZXIgPiAwXCIgaWQ9XCJuZy13ZWJjYW0tY291bnRlclwiPnt7dm0uY291bnRlcn19PC9zcGFuPicsXG4gICAgICAgICc8aW1nIG5nLXNob3c9XCJ2bS53ZWJjYW1MaXZlID09PSB0cnVlXCIgaWQ9XCJuZy13ZWJjYW0tb3ZlcmxheVwiIHNyYz1cInt7dm0uY29uZmlnLm92ZXJsYXl9fVwiIC8+JyxcbiAgICAgICAgJzxkaXYgaWQ9XCJuZy13ZWJjYW0tY29udGFpbmVyXCI+PC9kaXY+JyxcbiAgICAgICAgJzwvZGl2PiddLmpvaW4oJycpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGxpbmsoc2NvcGUsIGVsZW1lbnQsIGF0dHJzLCBjdHJsKSB7XG4gICAgICBjdHJsLmluaXQoKTtcbiAgICAgIHNjb3BlLiRvbignJGRlc3Ryb3knLCBmdW5jdGlvbigpIHtcbiAgICAgICAgY3RybC5kZXN0cm95KCk7XG4gICAgICB9KTtcbiAgICB9XG5cbiAgICBuZ1dlYmNhbUNvbnRyb2xsZXIuJGluamVjdCA9IFsnJHNjb3BlJywgJyRpbnRlcnZhbCddO1xuXG4gICAgZnVuY3Rpb24gbmdXZWJjYW1Db250cm9sbGVyKCRzY29wZSwgJGludGVydmFsKSB7XG4gICAgICAvKmpzaGludCB2YWxpZHRoaXM6IHRydWUgKi9cbiAgICAgIHZhciB2bSA9IHRoaXM7XG4gICAgICB2YXIgc291bmQsIHNuYXBzaG90VGltZXIsIGNvdW50ZG93blRpbWVyO1xuICAgICAgdmFyIGltYWdlcyA9IFtdO1xuICAgICAgdm0ud2ViY2FtTG9hZGVkID0gZmFsc2U7XG4gICAgICB2bS53ZWJjYW1MaXZlID0gZmFsc2U7XG4gICAgICB2bS5jb3VudGVyID0gMztcbiAgICAgIHZtLmluaXQgPSBpbml0O1xuICAgICAgdm0uZGVzdHJveSA9IGRlc3Ryb3k7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9jYXB0dXJlXG4gICAgICAgKiAgQGRlc2NyaXB0aW9uXG4gICAgICAgKlxuICAgICAgICogIExpc3RlbmVyIGZvciBjYXB0dXJlIHVzZXIgYWN0aW9uXG4gICAgICAgKlxuICAgICAgICogIEB1c2FnZVxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fY2FwdHVyZScpO2BcbiAgICAgICAqL1xuICAgICAgJHNjb3BlLiRvbignbmdXZWJjYW1fY2FwdHVyZScsIG9uV2ViY2FtQ2FwdHVyZSk7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vblxuICAgICAgICogIEBkZXNjcmlwdGlvblxuICAgICAgICpcbiAgICAgICAqICBMaXN0ZW5lciBmb3IgY2FtZXJhIG9uIHVzZXIgYWN0aW9uXG4gICAgICAgKlxuICAgICAgICogIEB1c2FnZVxuICAgICAgICogIGAkc2NvcGUuJGJyb2FkY2FzdCgnbmdXZWJjYW1fb24nKTtgXG4gICAgICAgKi9cbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29uJywgb25XZWJjYW1Pbik7XG4gICAgICAvKipcbiAgICAgICAqICBAbmdkb2MgbGlzdGVuZXJcbiAgICAgICAqICBAbmFtZSBuZ1dlYmNhbV9vZmZcbiAgICAgICAqICBAZGVzY3JpcHRpb25cbiAgICAgICAqXG4gICAgICAgKiAgTGlzdGVuZXIgZm9yIGNhbWVyYSBvZmYgdXNlciBhY3Rpb25cbiAgICAgICAqXG4gICAgICAgKiAgQHVzYWdlXG4gICAgICAgKiAgYCRzY29wZS4kYnJvYWRjYXN0KCduZ1dlYmNhbV9vZmYnKTtgXG4gICAgICAgKi9cbiAgICAgICRzY29wZS4kb24oJ25nV2ViY2FtX29mZicsIG9uV2ViY2FtT2ZmKTtcblxuICAgICAgZnVuY3Rpb24gaW5pdCgpIHtcbiAgICAgICAgdm0uY29uZmlnID0gdm0uY29uZmlnIHx8IHt9O1xuICAgICAgICBpZih3aW5kb3cubG9jYWxTdG9yYWdlKSB3aW5kb3cubG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3Zpc2l0ZWQnLCAnMScpO1xuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy52aWV3ZXJXaWR0aCkpIHZtLmNvbmZpZy52aWV3ZXJXaWR0aCA9ICdhdXRvJztcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcudmlld2VySGVpZ2h0KSkgdm0uY29uZmlnLnZpZXdlckhlaWdodCA9ICdhdXRvJztcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcub3V0cHV0V2lkdGgpKSB2bS5jb25maWcub3V0cHV0V2lkdGggPSAzMjA7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLm91dHB1dEhlaWdodCkpIHZtLmNvbmZpZy5vdXRwdXRIZWlnaHQgPSAyNDA7XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNVbmRlZmluZWQodm0uY29uZmlnLmRlbGF5KSkgdm0uY29uZmlnLmRlbGF5ID0gMDtcbiAgICAgICAgaWYoYW5ndWxhci5pc1VuZGVmaW5lZCh2bS5jb25maWcuc2hvdHMpKSB2bS5jb25maWcuc2hvdHMgPSAxO1xuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5jb3VudGRvd24pKSB2bS5jb25maWcuY291bnRkb3duID0gMDtcbiAgICAgICAgY29uZmlndXJlTGlzdGVuZXJzKCk7XG4gICAgICAgIGNvbmZpZ3VyZSgpO1xuICAgICAgfVxuXG4gICAgICBmdW5jdGlvbiBkZXN0cm95KCkge1xuICAgICAgICBpZih2bS53ZWJjYW1MaXZlKSBXZWJjYW0ucmVzZXQoKTtcbiAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IGZhbHNlO1xuICAgICAgICB2bS53ZWJjYW1Mb2FkZWQgPSBmYWxzZTtcbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQoc25hcHNob3RUaW1lcikpIHtcbiAgICAgICAgICAkaW50ZXJ2YWwuY2FuY2VsKHNuYXBzaG90VGltZXIpO1xuICAgICAgICAgIHNuYXBzaG90VGltZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYoYW5ndWxhci5pc0RlZmluZWQoY291bnRkb3duVGltZXIpKSB7XG4gICAgICAgICAgJGludGVydmFsLmNhbmNlbChjb3VudGRvd25UaW1lcik7XG4gICAgICAgICAgY291bnRkb3duVGltZXIgPSB1bmRlZmluZWQ7XG4gICAgICAgIH1cbiAgICAgICAgdm0uY291bnRlciA9IDM7XG5cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlKCkge1xuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuc2h1dHRlclVybCkpIHtcbiAgICAgICAgICBzb3VuZCA9IG5ldyBBdWRpbygpO1xuICAgICAgICAgIHNvdW5kLmF1dG9wbGF5ID0gZmFsc2U7XG4gICAgICAgICAgaWYobmF2aWdhdG9yLnVzZXJBZ2VudC5tYXRjaCgvRmlyZWZveC8pKSB7XG4gICAgICAgICAgICBzb3VuZC5zcmMgPSB2bS5jb25maWcuc2h1dHRlclVybC5zcGxpdCgnLicpWzBdICsgJy5vZ2cnO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBzb3VuZC5zcmMgPSB2bS5jb25maWcuc2h1dHRlclVybDtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgV2ViY2FtLnNldCh7XG4gICAgICAgICAgd2lkdGg6IHZtLmNvbmZpZy52aWV3ZXJXaWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IHZtLmNvbmZpZy52aWV3ZXJIZWlnaHQsXG4gICAgICAgICAgZGVzdF93aWR0aDogdm0uY29uZmlnLm91dHB1dFdpZHRoLFxuICAgICAgICAgIGRlc3RfaGVpZ2h0OiB2bS5jb25maWcub3V0cHV0SGVpZ2h0LFxuICAgICAgICAgIGZvcmNlX2ZsYXNoOiBmYWxzZSxcbiAgICAgICAgICBpbWFnZV9mb3JtYXQ6ICdqcGVnJyxcbiAgICAgICAgICBqcGVnX3F1YWxpdHk6IDEwMCxcbiAgICAgICAgICBmbGlwX2hvcml6OiB0cnVlXG4gICAgICAgIH0pO1xuICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpKSB7XG4gICAgICAgICAgV2ViY2FtLnNldCgnZmxhc2hOb3REZXRlY3RlZFRleHQnLCB2bS5jb25maWcuZmxhc2hOb3REZXRlY3RlZFRleHQpO1xuICAgICAgICB9XG4gICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLmNvbmZpZy5mbGFzaEZhbGxiYWNrVXJsKSkge1xuICAgICAgICAgIFdlYmNhbS5zZXRTV0ZMb2NhdGlvbih2bS5jb25maWcuZmxhc2hGYWxsYmFja1VybCk7XG4gICAgICAgIH1cbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gY29uZmlndXJlTGlzdGVuZXJzKCkge1xuICAgICAgICBXZWJjYW0ub24oJ2xvYWQnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ud2ViY2FtTG9hZGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uTG9hZCkpIHtcbiAgICAgICAgICAgICAgdm0ub25Mb2FkKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgICAgICBXZWJjYW0ub24oJ2xpdmUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAkc2NvcGUuJGFwcGx5KGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgdm0ud2ViY2FtTGl2ZSA9IHRydWU7XG4gICAgICAgICAgICBpZihhbmd1bGFyLmlzRGVmaW5lZCh2bS5vbkxpdmUpKSB7XG4gICAgICAgICAgICAgIHZtLm9uTGl2ZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgV2ViY2FtLm9uKCdlcnJvcicsIGZ1bmN0aW9uKGVycikge1xuICAgICAgICAgIGlmKGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uRXJyb3IpKSB7XG4gICAgICAgICAgICB2bS5vbkVycm9yKHtlcnI6ZXJyfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gY2FwdHVyZShpbmRleCkge1xuICAgICAgICBpZihzb3VuZCkge1xuICAgICAgICAgIHNvdW5kLnBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgICBpZihpbmRleCA9PT0gKHZtLmNvbmZpZy5zaG90cy0xKSkge1xuICAgICAgICAgICRpbnRlcnZhbC5jYW5jZWwoc25hcHNob3RUaW1lcik7XG4gICAgICAgIH1cbiAgICAgICAgV2ViY2FtLnNuYXAoZnVuY3Rpb24oZGF0YV91cmkpIHtcbiAgICAgICAgICBpbWFnZXNbaW5kZXhdID0gZGF0YV91cmk7XG4gICAgICAgICAgaWYoaW5kZXggPCAodm0uY29uZmlnLnNob3RzLTEpICYmIGFuZ3VsYXIuaXNEZWZpbmVkKHZtLm9uQ2FwdHVyZVByb2dyZXNzKSkge1xuICAgICAgICAgICAgdmFyIHByb2dyZXNzID0gTWF0aC5yb3VuZCgoKGluZGV4KzEpICogMTAwKSAvIHZtLmNvbmZpZy5zaG90cyk7XG4gICAgICAgICAgICB2bS5vbkNhcHR1cmVQcm9ncmVzcyh7c3JjOiBkYXRhX3VyaSxwcm9ncmVzczogcHJvZ3Jlc3N9KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYoaW5kZXggPT09ICh2bS5jb25maWcuc2hvdHMtMSkgJiYgYW5ndWxhci5pc0RlZmluZWQodm0ub25DYXB0dXJlQ29tcGxldGUpKSB7XG4gICAgICAgICAgICByZXR1cm4gdm0ub25DYXB0dXJlQ29tcGxldGUoe3NyYzogaW1hZ2VzfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1DYXB0dXJlKCkge1xuICAgICAgICBpZihhbmd1bGFyLmlzVW5kZWZpbmVkKHZtLmNvbmZpZy5jb3VudGRvd24pKSB7XG4gICAgICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgICAgICBzbmFwc2hvdFRpbWVyID0gJGludGVydmFsKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgY2FwdHVyZShjb3VudCk7XG4gICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgIH0sICh2bS5jb25maWcuZGVsYXkgKiAxMDAwKSwgdm0uY29uZmlnLnNob3RzKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZihjb3VudGRvd25UaW1lciAhPT0gdW5kZWZpbmVkKSByZXR1cm47XG4gICAgICAgICAgdm0uY291bnRlciA9IDM7XG4gICAgICAgICAgY291bnRkb3duVGltZXIgPSAkaW50ZXJ2YWwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2bS5jb3VudGVyID0gdm0uY291bnRlciAtIDE7XG4gICAgICAgICAgICBpZih2bS5jb3VudGVyID09PSAwKSB7XG4gICAgICAgICAgICAgIGlmKGNvdW50ZG93blRpbWVyKSB7XG4gICAgICAgICAgICAgICAgJGludGVydmFsLmNhbmNlbChjb3VudGRvd25UaW1lcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgdmFyIGNvdW50ID0gMDtcbiAgICAgICAgICAgICAgc25hcHNob3RUaW1lciA9ICRpbnRlcnZhbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBjYXB0dXJlKGNvdW50KTtcbiAgICAgICAgICAgICAgICBjb3VudCsrO1xuICAgICAgICAgICAgICB9LCAodm0uY29uZmlnLmRlbGF5ICogMTAwMCksIHZtLmNvbmZpZy5zaG90cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSwgMTAwMCwgMyk7XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PbigpIHtcbiAgICAgICAgV2ViY2FtLmF0dGFjaCgnI25nLXdlYmNhbS1jb250YWluZXInKTtcbiAgICAgIH1cblxuICAgICAgZnVuY3Rpb24gb25XZWJjYW1PZmYoKSB7XG4gICAgICAgIGRlc3Ryb3koKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRpcmVjdGl2ZTtcbiAgfVxufSkoKTsiXX0=
